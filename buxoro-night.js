const translations = {
  ru: {
    noData: 'N/A',
    airQuality: 'Качество воздуха:',
    aboveSeaLevel: 'м над уровнем море',
    temperature: 'Температура',
    humidity: 'Bлажность',
    precipitation: 'Ocaдки',
    windspeed: 'Скорость ветра',
    winddirection: 'Направление ветра',
    atmPressure: 'Атм. давление',
    uvindex: 'УФ индекс',
    precipitation_probability: 'Вероятность осадков',
    today: 'Сегодня',
    tomorrow: 'Завтра',
    startFinish: 'Ковчег Бухары',
    bakhmal: 'Бахмал (25км)',
    aqi: {
      good: 'Xopoшoe',
      moderate: 'Умеренное',
      unhealthy: 'Нездаровое',
      unhealthyForSG: 'Нездаровое',
      veryUnhealthy: 'Вредное',
      hazardous: 'Опасное',
    },
    weekday: {
      sun: 'Bc',
      mon: 'Пн',
      tue: 'Вт',
      wed: 'Cp',
      thu: 'Чт',
      fri: 'Пт',
      sat: 'Cб',
    },
    pictocode: {
      1: 'Ясное, безоблачное небо',
      2: 'Ясное, несколько перистых облаков',
      3: 'Ясное с перистыми облаками',
      4: 'Ясное с несколькими низкими облаками',
      5: 'Ясное с несколькими низкими облаками и немного перистыми',
      6: 'Ясное с несколькими низкими облаками и перистыми',
      7: 'Частичная облачность',
      8: 'Частичная облачность с немного перистыми облаками',
      9: 'Частичная облачность с перистыми облаками',
      10: 'Смешанное облаков с возможностью грозы',
      11: 'Смешанное облаков с немного перистыми облаками и возможностью грозы',
      12: 'Смешанное облаков с перистыми облаками и возможностью грозы',
      13: 'Ясное, но с туманом',
      14: 'Ясное, но с туманом и немного перистыми облаками',
      15: 'Ясное, но с туманом и перистыми облаками',
      16: 'Туман/низкослоистые облака',
      17: 'Туман/низкослоистые облака с немного перистыми облаками',
      18: 'Туман/низкослоистые облака с перистыми облаками',
      19: 'В основном облачно',
      20: 'В основном облачно с немного перистыми облаками',
      21: 'В основном облачно с перистыми облаками',
      22: 'Пасмурно',
      23: 'Пасмурно с дождем',
      24: 'Пасмурно со снегом',
      25: 'Пасмурно с сильным дождем',
      26: 'Пасмурно с сильным снегом',
      27: 'Дождь, вероятность грозы',
      28: 'Легкий дождь, вероятность грозы',
      29: 'Шторм с сильным снегом',
      30: 'Сильный дождь, вероятность грозы',
      31: 'Смешанное с кратковременными дождями',
      32: 'Смешанное с кратковременными снегопадами',
      33: 'Пасмурно с легким дождем',
      34: 'Пасмурно с легким снегом',
      35: 'Пасмурно с смесью снега и дождя',
    },
  },
  uz: {
    noData: 'N/A',
    airQuality: 'Havo sifati:',
    aboveSeaLevel: 'm dengiz sathidan',
    temperature: 'Harorat',
    humidity: 'Nisbiy namlik',
    precipitation: "Yog'ingarchilik",
    windspeed: 'Shamol tezligi',
    winddirection: "Shamol yo'nalishi",
    atmPressure: 'Atm. bosimi',
    uvindex: 'Ultrabinafsha',
    precipitation_probability: 'Yog`ingarchilik ehtimoli',
    today: 'Bugun',
    tomorrow: 'Ertaga',
    startFinish: 'Buxoro arki',
    bakhmal: 'Baxmal (25km)',
    aqi: {
      good: 'Yaxshi',
      moderate: "O'rtacha",
      unhealthyForSG: "Nosog'lom",
      unhealthy: "Nosog'lom",
      veryUnhealthy: 'Zararli',
      hazardous: 'Xavfli',
    },
    weekday: {
      sun: 'Yak',
      mon: 'Du',
      tue: 'Se',
      wed: 'Chor',
      thu: 'Pay',
      fri: 'Ju',
      sat: 'Sha',
    },
    pictocode: {
      1: 'Ochiq, bulutsiz osmon',
      2: 'Ochiq, bir qancha patsimon bulutlar',
      3: 'Ochiq, bir qancha patsimon bulutlar',
      4: 'Ochiq, bir necha past bulutlar',
      5: 'Ochiq, bir necha past bulutlar va bir necha patsimon bulutlar',
      6: 'Ochiq, bir necha past bulutlar va bir necha patsimon bulutlar',
      7: 'Qisman bulutli',
      8: 'Qisman bulutli va bir necha patsimon bulutlar',
      9: 'Qisman bulutli va patimon bulutlar',
      10: "Biroz momaqaldiroq bulutlari aralashgan bo'lishi mumkin",
      11: "Biroz momaqaldiroq bulutlari va patsimon bulutlar aralashgan bo'lishi mumkin",
      12: "Biroz momaqaldiroq bulutlari va patsimon bulutlar aralashgan bo'lishi mumkin",
      13: 'Ochiq, lekin tumanli',
      14: 'Ochiq, lekin tumanli va bir necha patsimon bulutlar',
      15: 'Ochiq, lekin tumanli va patsimon bulutlar',
      16: 'Tuman/qatlamli past bulutlar',
      17: 'Tuman/qatlamli past bulutlar va bir necha patsimon bulutlar',
      18: 'Tuman/qatlamli past bulutlar va patsimon bulutlar',
      19: 'Asosan bulutli',
      20: 'Asosan bulutli va bir necha patsimon bulutlar',
      21: 'Asosan bulutli va patsimon bulutlar',
      22: 'Bulutli',
      23: 'Bulutli va yomgirli',
      24: 'Bulutli va qorli',
      25: "Kuchli yomg'ir",
      26: 'Kuchli qor',
      27: "Yomg'ir, ehtimoliy momaqaldiroq",
      28: "Yengil yomg'ir, ehtimoliy momaqaldiroq",
      29: "Qorli bo'ron",
      30: "Kuchli yomg'ir, ehtimoliy momaqaldiroq",
      31: "Qisqa yomg'ir",
      32: 'Qisqa qor',
      33: "Bulutli va yengil yomg'ir",
      34: 'Bulutli va yengil qor',
      35: "Bulutli va qorli yomg'ir",
    },
  },
  en: {
    noData: 'N/A',
    airQuality: 'Air quality:',
    aboveSeaLevel: 'm above sea level',
    temperature: 'Air temperature',
    humidity: 'Humidity',
    precipitation: 'Precipitation',
    windspeed: 'Wind speed',
    winddirection: 'Wind direction',
    atmPressure: 'Atm. pressure',
    uvindex: 'UV index',
    precipitation_probability: 'Precipitation probability',
    today: 'Today',
    tomorrow: 'Tomorrow',
    startFinish: 'Ark of Bukhara',
    bakhmal: 'Bakhmal (25km)',
    aqi: {
      good: 'Good',
      moderate: 'Moderate',
      unhealthyForSG: 'Unhealthy',
      unhealthy: 'Unhealthy',
      veryUnhealthy: 'Very Unhealthy',
      hazardous: 'Hazardous',
    },
    weekday: {
      sun: 'Sun',
      mon: 'Mon',
      tue: 'Tue',
      wed: 'Wed',
      thu: 'Thu',
      fri: 'Fri',
      sat: 'Sat',
    },
    pictocode: {
      1: 'Clear, cloudless sky',
      2: 'Clear, few cirrus',
      3: 'Clear with cirrus',
      4: 'Clear with few low clouds',
      5: 'Clear with few low clouds and few cirrus',
      6: 'Clear with few low clouds and cirrus',
      7: 'Partly cloudy',
      8: 'Partly cloudy and few cirrus',
      9: 'Partly cloudy and cirrus',
      10: 'Mixed with some thunderstorm clouds possible',
      11: 'Mixed with few cirrus with some thunderstorm clouds possible',
      12: 'Mixed with cirrus with some thunderstorm clouds possible',
      13: 'Clear but hazy',
      14: 'Clear but hazy with few cirrus',
      15: 'Clear but hazy with cirrus',
      16: 'Fog/low stratus clouds',
      17: 'Fog/low stratus clouds with few cirrus',
      18: 'Fog/low stratus clouds with cirrus',
      19: 'Mostly cloudy',
      20: 'Mostly cloudy with few cirrus',
      21: 'Mostly cloudy and cirrus',
      22: 'Overcast',
      23: 'Overcast with rain',
      24: 'Overcast with snow',
      25: 'Overcast with heavy rain',
      26: 'Overcast with heavy snow',
      27: 'Rain, thunderstorms likely',
      28: 'Light rain, thunderstorms likely',
      29: 'Storm with heavy snow',
      30: 'Heavy rain, thunderstorms likely',
      31: 'Mixed with showers',
      32: 'Mixed with snow showers',
      33: 'Overcast with light rain',
      34: 'Overcast with light snow',
      35: 'Overcast with mixture of snow and rain',
    },
  },
};

const buxoroToken = 'Bearer 17|CYwuDZ94aBsuk1baS06icjkKMr2UYFEbDvqnHc16';
const buxoroStationId = '066012023';
const comAmudarIO = {
  language: 'en',
  _dustColor: '',
  _forecastData: [],
  _headers_buxoro: {
    Authorization: buxoroToken,
    'Content-Type': 'application/json;charset=utf-8',
  },

  start: async function () {
    this.setTitle();
    const forecastData = await this.getForecastData();
    this._forecastData = forecastData;
    const currentForecastStart = forecastData.find(
      (d) => new Date(d.time).getHours() === new Date().getHours()
    );
    const meteostationData = await this.getMeteostationData();
    const device = (await this.getDevice()).find(
      (d) => d.serial_number === '066012023'
    );
    const imgSrcStart = this.getImgSrc(
      currentForecastStart.pictocode,
      currentForecastStart.isdaylight
    );
    this.setPictocodeDescription(currentForecastStart.pictocode);
    this.setASL(device);
    this.addMeteostationData(
      meteostationData[meteostationData.length - 1],
      currentForecastStart
    );
    this.setCurrentTemperature(meteostationData, imgSrcStart);
  },

  setTitle: function () {
    const titleStart = document.querySelector('.title-start');
    titleStart.innerHTML = translations[this.language].startFinish;
  },

  setPictocodeDescription: function (pictocode) {
    const pictocodeDescription = document
      .querySelector('.pictocode-description')
      .querySelector('p');
    pictocodeDescription.innerHTML =
      translations[this.language].pictocode[pictocode];
  },

  getImgSrc: function (pictocode, isDayLight) {
    pictocode = pictocode < 10 ? '0' + pictocode : pictocode;
    const src = pictocode + (isDayLight ? '_day.svg' : '_night.svg');
    return 'assets/meteoblue_weather_pictograms_2016-11-04/svg/' + src;
  },

  getDevice: async function () {
    const response = await fetch('https://oxus.amudar.io/api/meteoDevices', {
      method: 'GET',
      headers: this._headers_buxoro,
    });
    const devices = (await response.json()).data;
    return devices;
  },

  getMeteostationData: async function () {
    const resp = await fetch('https://oxus.amudar.io/api/influx/meteostation', {
      method: 'POST',
      headers: this._headers_buxoro,
      body: JSON.stringify({
        stationId: '066012023',
        start: '-1d',
        end: 'now()',
        interval: '1h',
      }),
    });
    const data = await resp.json();
    return data.data;
  },

  getForecastData: async function () {
    const response = await fetch(
      'https://oxus.amudar.io/api/forecasts/device/066012023',
      {
        method: 'GET',
        headers: this._headers_buxoro,
      }
    );
    const responseJSON = await response.json();
    const data = responseJSON.data;
    return data;
  },

  getLast4Days: function (data) {
    const day = 24;
    const currentHour = new Date().getHours();
    const targetDate = Date.now() - (Date.now() % (3600 * 1000));
    const now = data.findIndex(
      (obj) => new Date(obj.time).valueOf() === targetDate
    );
    const the17th = data.findIndex((d) => {
      const date = new Date(d.time);
      return date.getDate() === 17 && date.getHours() === currentHour;
    });
    const the18th = data.findIndex((d) => {
      const date = new Date(d.time);
      return date.getDate() === 18 && date.getHours() === currentHour;
    });
    const filtered = [data[now], data[now + day], data[the17th], data[the18th]];
    return filtered;
  },

  setASL: function (device) {
    const aslStartContainer = document.querySelector('.asl-start');
    aslStartContainer.innerHTML =
      device.asl + translations[this.language].aboveSeaLevel;
  },

  setCurrentTemperature: function (data, imgSrc) {
    const currentTemperature = Math.round(data[data.length - 1].AirT);
    const temperatures = data.map((d) => d.AirT);
    const max = Math.max(...temperatures);
    const min = Math.min(...temperatures);
    const picElement = document
      .querySelector('.bukhara-wrapper')
      .querySelector('.pictocode')
      .querySelector('img');
    picElement.setAttribute('src', imgSrc);
    document.querySelector('.max-temp').innerHTML = Math.round(max) + '°C';
    document.querySelector('.min-temp').innerHTML = Math.round(min) + '°C';
    document.querySelector('.temperature-big').innerHTML =
      currentTemperature + '°';
  },

  setCurrentTemperatureFinish: function (data, imgSrc) {
    const todayData = data.slice(0, 24);
    const currentTemperature = todayData.find(
      (d) => new Date(d.time).getHours() === new Date().getHours()
    ).temperature;
    const temperatures = todayData.map((d) => d.temperature);
    const max = Math.max(...temperatures);
    const min = Math.min(...temperatures);
    const picElement = document
      .querySelector('.meteostation-finish')
      .querySelector('.pictocode')
      .querySelector('img');
    picElement.setAttribute('src', imgSrc);

    document
      .querySelector('.meteostation-finish')
      .querySelector('.max-temp').innerHTML = Math.round(max) + '°C';
    document
      .querySelector('.meteostation-finish')
      .querySelector('.min-temp').innerHTML = Math.round(min) + '°C';
    document
      .querySelector('.meteostation-finish')
      .querySelector('.temperature-big').innerHTML =
      Math.round(currentTemperature) + '°';
  },

  //   generateForecastCards: function (data) {
  //     const forecastStartContainer = document.querySelector('.forecast-start');
  //     const forecastEndContainer = document.querySelector('.forecast-end');
  //     let lastAQI = 0;
  //     let lastDust = 0;
  //     for (let i = 0; i < data.length; i++) {
  //       const element = data[i];
  //       lastAQI =
  //         i > 0
  //           ? data[i - 1].airqualityindex
  //             ? data[i - 1].airqualityindex
  //             : lastAQI
  //           : 0;
  //       lastDust = i > 0 ? (data[i - 1].pm25 ? data[i - 1].pm25 : lastDust) : 0;
  //       let forecastCard = document.createElement('div');
  //       forecastCard.setAttribute('class', 'forecast-card col-12 col-sm-6 p-1');
  //       forecastCard.innerHTML = `<div class="card-wrapper">
  //             ${this.getDateElement(element.time, i)}
  //             ${this.getTemperatureElement(element.time)}
  //             ${this.getWindElement(element)}
  //             ${this.getUVElement(element.uvindex)}
  //             ${this.getRainElement(element)}
  //             ${this.getDustElement(element.pm25, lastDust)}
  //             </div>
  //           `;
  //       if (i == 0 || i == 1) {
  //         forecastStartContainer.append(forecastCard);
  //       } else {
  //         forecastEndContainer.append(forecastCard);
  //       }
  //     }
  //   },

  getTemperature: function (data) {
    const day = 24;
    let temperatures = [];
    for (let i = 0; i < 96; i += day) {
      const dayData = data.slice(i, i + day).map((d) => d.temperature);
      const hot = Math.max(...dayData);
      const cold = Math.min(...dayData);
      temperatures.push({ hot, cold });
    }
    return temperatures;
  },

  getDay: function (time) {
    const dayNumber = new Date(time).getDay();
    const days = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'];
    const dayTranslated = translations[this.language].weekday[days[dayNumber]];
    return dayTranslated;
  },

  getDate: function (time) {
    const dateObj = new Date(time);
    const day = dateObj.getDate();
    let month = dateObj.getMonth() + 1;
    const years = dateObj.getFullYear();
    month = month < 10 ? '0' + month : month;
    return `${day}.${month}.${years}`;
  },

  getWindDirections: function (degree) {
    if (degree >= 0 && degree <= 22.5) {
      return '↓';
    }
    if (degree >= 22.5 && degree <= 67.5) {
      return '<b>↙</b>';
    }
    if (degree >= 67.5 && degree <= 112.5) {
      return '←';
    }
    if (degree >= 112.5 && degree <= 157.5) {
      return '<b>↖</b>';
    }
    if (degree >= 157.5 && degree <= 202.5) {
      return '↑';
    }
    if (degree >= 202.5 && degree <= 247.5) {
      return '<b>↗</b>';
    }
    if (degree >= 247.5 && degree <= 292.5) {
      return '→';
    }
    if (degree >= 292.5 && degree <= 337.5) {
      return '<b>↘</b>';
    }
    if (degree >= 337.5 && degree <= 360) {
      return '↓';
    }
  },

  addMeteostationData: function (data, forecast) {
    const rainElem = document.querySelector('.c-rain');
    rainElem.innerHTML = `<span><i class="fa-solid fa-cloud-rain me-2"></i>${
      translations[this.language].precipitation
    }</span
        ><span class="rain-value value">${Math.round(data.Rain)}mm</span>`;

    const precipitation_probability = document.querySelector(
      '.c-precipitation-probability'
    );
    precipitation_probability.innerHTML = `<span><i class="fa-solid fa-percentage me-2"></i>
    ${translations[this.language].precipitation_probability}</span>
    <span class="probability-value value">${Math.round(
      forecast.precipitation_probability
    )}%</span>`;

    const humidityElem = document.querySelector('.c-humidity');
    humidityElem.innerHTML = `<span
        ><i class="fa-solid fa-droplet me-2"></i>${
          translations[this.language].humidity
        }</span
      ><span class="humidity-value value">${Math.round(data.AirH)}%</span>`;

    const windspeedElem = document.querySelector('.c-windspeed');
    windspeedElem.innerHTML = `<span
        ><i class="fa-solid fa-wind me-2"></i>${
          translations[this.language].windspeed
        }</span
      ><span class="windspeed-value value">${Math.round(
        data.WindMax
      )}m/c</span>`;

    const winddirectionElem = document.querySelector('.c-winddirection');
    winddirectionElem.innerHTML = `<span
        ><i class="fa-solid fa-location-arrow me-2"></i>${
          translations[this.language].winddirection
        }</span
      ><span class="winddirection-value value">${this.getWindDirections(
        data.WindD
      )}</span>`;

    const uvindexElem = document.querySelector('.c-uvindex');
    uvindexElem.innerHTML = `<span
        ><i class="fa-solid fa-sun me-2"></i>${
          translations[this.language].uvindex
        }</span
      ><span class="atm-pressure-value value">${
        Math.round(forecast.uvindex) || 0
      }</span>`;
  },

  addMeteostationFinishData: function (data) {
    const temperatureElem = document
      .querySelector('.meteostation-finish')
      .querySelector('.c-temperature');
    temperatureElem.innerHTML = `<span>
        <i class="fa-solid fa-temperature-three-quarters me-2"></i>${
          translations[this.language].temperature
        }</span
      ><span class="temperature-value value">${Math.round(
        data.temperature
      )}°C</span>`;

    const humidityElem = document
      .querySelector('.meteostation-finish')
      .querySelector('.c-humidity');
    humidityElem.innerHTML = `<span
        ><i class="fa-solid fa-droplet me-2"></i>${
          translations[this.language].humidity
        }</span
      ><span class="humidity-value value">${Math.round(
        data.relativehumidity
      )}%</span>`;

    const rainElem = document
      .querySelector('.meteostation-finish')
      .querySelector('.c-rain');
    rainElem.innerHTML = `<span><i class="fa-solid fa-cloud-rain me-2"></i>${
      translations[this.language].precipitation
    }</span
        ><span class="rain-value value">${Math.round(
          data.precipitation
        )}mm</span>`;

    const windspeedElem = document
      .querySelector('.meteostation-finish')
      .querySelector('.c-windspeed');
    windspeedElem.innerHTML = `<span
        ><i class="fa-solid fa-wind me-2"></i>${
          translations[this.language].windspeed
        }</span
      ><span class="windspeed-value value">${Math.round(
        data.windspeed
      )}m/c</span>`;
    const winddirectionElem = document
      .querySelector('.meteostation-finish')
      .querySelector('.c-winddirection');
    winddirectionElem.innerHTML = `<span
        ><i class="fa-solid fa-location-arrow me-2"></i>${
          translations[this.language].winddirection
        }</span
      ><span class="winddirection-value value">${this.getWindDirections(
        data.winddirection
      )}</span>`;

    const atmPressure = this.convertPressureByAltitude(
      data.sealevelpressure,
      1949,
      data.temperature
    );

    const atmPressureElem = document
      .querySelector('.meteostation-finish')
      .querySelector('.c-air-pressure');
    atmPressureElem.innerHTML = `<span
        ><i class="fa-solid fa-arrow-down me-2"></i>${
          translations[this.language].atmPressure
        }</span
      ><span class="atm-pressure-value value">${
        Math.round(atmPressure) + 'mBar'
      }</span>`;
  },

  getDateElement: function (time, i) {
    let html = `<span>${this.getDate(time)}</span>`;
    if (i === 0) html = `<span>${translations[this.language].today}</span>`;
    if (i === 1) html = `<span>${translations[this.language].tomorrow}</span>`;
    const dateElemContainer = document.createElement('div');
    dateElemContainer.classList.add('date-part', 'part');
    dateElemContainer.innerHTML = html;
    return dateElemContainer.outerHTML;
  },

  getTemperatureMaxMin: function (time) {
    const day = 24;
    const date = new Date(time).getDate();
    const dayStartIndex = this._forecastData.findIndex(
      (d) => new Date(d.time).getDate() === date
    );
    const dayForecast = this._forecastData.slice(
      dayStartIndex,
      dayStartIndex + day
    );
    const temperatures = dayForecast.map((d) => d.temperature);
    const hot = Math.max(...temperatures);
    const cold = Math.min(...temperatures);
    return { hot, cold };
  },

  getTemperatureElement: function (time) {
    const temperatureContainer = document.createElement('div');
    temperatureContainer.classList.add('temperature-part', 'part');
    const temperature = this.getTemperatureMaxMin(time);

    const hotDiv = document.createElement('div');
    hotDiv.style = `background-color: yellow`;
    hotDiv.innerHTML = Math.round(temperature.hot) + ' <span>°C</span>';
    temperatureContainer.append(hotDiv);

    const coldDiv = document.createElement('div');
    coldDiv.style = `color: black; background-color: lightblue`;
    coldDiv.innerHTML = Math.round(temperature.cold) + ' <span>°C</span>';
    temperatureContainer.append(coldDiv);
    return temperatureContainer.outerHTML;
  },

  getWindElement: function (element) {
    const windContainer = document.createElement('div');
    windContainer.classList.add('wind-part', 'part');
    const windElement = document.createElement('div');
    windElement.innerHTML =
      this.getWindDirections(element.winddirection) +
      ' ' +
      Math.round(element.windspeed) +
      ' <span>м/c</span>';
    windContainer.append(windElement);
    return windContainer.outerHTML;
  },

  getWindSpeedElement: function (windspeed) {
    const windContainer = document.createElement('div');
    windContainer.classList.add('wind-part', 'part');
    const windElement = document.createElement('div');
    windElement.innerHTML = Math.round(windspeed) + ' <span>м/c</span>';
    windContainer.append(windElement);
    return windContainer.outerHTML;
  },

  getWindDirectionElement: function (winddirection) {
    const windDrctElemContainer = document.createElement('div');
    windDrctElemContainer.classList.add('wind-direction-part', 'part');

    const windDrctElement = document.createElement('div');
    windDrctElement.innerHTML = this.getWindDirections(winddirection);
    windDrctElemContainer.append(windDrctElement);
    return windDrctElemContainer.outerHTML;
  },

  getUVElement: function (uvindex) {
    const uvElemContainer = document.createElement('div');
    uvElemContainer.classList.add('uv-part', 'part');

    const uvElement = document.createElement('div');
    uvElement.innerHTML = '☀️ ';
    if (uvindex > 11) {
      uvElement.innerHTML += '11+';
      uvElement.style = 'background-color: #998CFF';
    } else {
      uvElement.innerHTML += uvindex + '<span>/11 UV</span>';
    }
    uvElemContainer.append(uvElement);
    return uvElemContainer.outerHTML;
  },

  getRainElement: function (element) {
    const precipitation = element.precipitation;
    const rainElemContainer = document.createElement('div');
    rainElemContainer.classList.add('rain-part', 'part');

    const rainElement = document.createElement('div');
    if (precipitation > 0) {
      const isBelowOne = precipitation < 1;
      rainElement.innerHTML = `<img src="assets/raindrop.png">${
        isBelowOne ? '< 1' : precipitation
      }<span>mm</span>`;
    } else {
      rainElement.innerHTML = '<img src="assets/raindrop.png"> -';
    }
    rainElement.innerHTML += ` (${element.precipitation_probability}%)`;
    rainElemContainer.append(rainElement);
    return rainElemContainer.outerHTML;
  },

  getHumidityElement: function (relativehumidity) {
    const humidityContainer = document.createElement('div');
    humidityContainer.classList.add('humidity-part', 'part');

    const humidityElement = document.createElement('div');
    humidityElement.innerHTML =
      Math.round(relativehumidity) + ' <span>%</span>';
    humidityContainer.append(humidityElement);
    return humidityContainer.outerHTML;
  },

  //   getAQIElement: function (airqualityindex, lastAQI) {
  //     const aqi = airqualityindex || lastAQI;
  //     const status = this.getStatusByForAQI(aqi);
  //     const config = AQI[status];
  //     let imgSrc = config.img;
  //     let bgColor = config.backgroundColor;
  //     this._dustColor = config.fontColor;

  //     const aqiContainer = document.createElement('div');
  //     aqiContainer.classList.add('aqi-part', 'part');

  //     const aqiValue = document.createElement('div');
  //     aqiValue.classList.add('aqi-value');
  //     aqiValue.innerHTML = `<span class='aqi-icon'>AQI</span>${aqi}`;
  //     aqiValue.style = `color: ${this._dustColor};`;

  //     const aqiImgWrapper = document.createElement('div');
  //     aqiImgWrapper.classList.add('aqi-img-wrapper');
  //     aqiImgWrapper.style = `background-color: ${bgColor};`;
  //     aqiImgWrapper.innerHTML = `<img src='assets/${imgSrc}'>`;
  //     aqiContainer.append(aqiValue);
  //     aqiContainer.append(aqiImgWrapper);
  //     return aqiContainer.outerHTML;
  //   },

  getDustElement: function (dustV, lastDust) {
    const dust = dustV || lastDust;
    const dustElemContainer = document.createElement('div');
    dustElemContainer.classList.add('dust-part', 'part');
    const dustElement = document.createElement('div');
    dustElement.style = `color: ${this._dustColor}`;
    dustElement.innerHTML =
      "<span class='aqi-icon'>PM2.5</span>" +
      Math.round(dust) +
      ' <span>μg/m3</span>';
    dustElemContainer.append(dustElement);
    return dustElemContainer.outerHTML;
  },

  addCurrentAQI: function (data) {
    const categoryRange = {
      good: 83,
      moderate: 66.4,
      unhealthyForSG: 49.8,
      unhealthy: 33.2,
      veryUnhealthy: 16.6,
      hazardous: 0,
    };

    const readings = data.map((d) => d['PM2.5']);
    const aqiService = new ComputingAQIService();
    const lastPM25 = readings[readings.length - 1];
    const category = aqiService.getCategory(lastPM25, 'PM2.5');
    const breakpoints = aqiService.breakpoints['PM2.5'][category];
    const AQIPercentage =
      categoryRange[category] +
      (1 -
        (lastPM25 - breakpoints.cLow) /
          (breakpoints.cHigh - breakpoints.cLow)) *
        16.6;
    const aqiPercentElem = document.querySelector('.aqi-percentage');
    aqiPercentElem.innerHTML = `<div class="aqi-percentage">
        <b>${
          translations[this.language].airQuality
        }</b> <span class="aqi-percent">${Math.round(AQIPercentage)}%</span>
      </div>`;
    const aqiStatusElem = document.querySelector('.aqi-status');
    aqiStatusElem.style = `color: ${AQI[category].fontColor}; background-color: ${AQI[category].backgroundColor}`;
    aqiStatusElem.innerHTML = translations[this.language].aqi[category];

    const pm25 = document.querySelector('.pm25-start');
    pm25.innerHTML = '<span>PM 2.5: </span>' + lastPM25 + ' <span>μg/m3</span>';
    pm25.style = `color: ${AQI[category].fontColor};`;

    const config = AQI[category];

    let imgSrc = config.img;
    let bgColor = config.backgroundColor;
    this._dustColor = config.fontColor;

    const aqiImgContainer = document.querySelector('.aqi-img');
    aqiImgContainer.innerHTML = `<img src='assets/${imgSrc}'>`;
    aqiImgContainer.style = `background-color: ${bgColor};`;
  },

  addCurrentAQIFinish: function (data) {
    const lastPM25 = Math.round(data.pm25);
    const categoryRange = {
      good: 83,
      moderate: 66.4,
      unhealthyForSG: 49.8,
      unhealthy: 33.2,
      veryUnhealthy: 16.6,
      hazardous: 0,
    };

    const aqiService = new ComputingAQIService();
    const category = aqiService.getCategory(lastPM25, 'PM2.5');
    const breakpoints = aqiService.breakpoints['PM2.5'][category];
    const AQIPercentage =
      categoryRange[category] +
      (1 -
        (lastPM25 - breakpoints.cLow) /
          (breakpoints.cHigh - breakpoints.cLow)) *
        16.6;
    const aqiPercentElem = document
      .querySelector('.meteostation-finish')
      .querySelector('.aqi-percentage');
    aqiPercentElem.innerHTML = `<div class="aqi-percentage">
        <b>${
          translations[this.language].airQuality
        }</b> <span class="aqi-percent">${Math.round(AQIPercentage)}%</span>
      </div>`;
    const aqiStatusElem = document
      .querySelector('.meteostation-finish')
      .querySelector('.aqi-status');
    aqiStatusElem.style = `color: ${AQI[category].fontColor}; background-color: ${AQI[category].backgroundColor}`;
    aqiStatusElem.innerHTML = translations[this.language].aqi[category];

    const pm25 = document.querySelector('.pm25-end');
    pm25.innerHTML = '<span>PM 2.5: </span>' + lastPM25 + ' <span>μg/m3</span>';
    pm25.style = `color: ${AQI[category].fontColor};`;

    const config = AQI[category];
    let imgSrc = config.img;
    let bgColor = config.backgroundColor;
    this._dustColor = config.fontColor;

    const aqiImgContainer = document
      .querySelector('.meteostation-finish')
      .querySelector('.aqi-img');
    aqiImgContainer.innerHTML = `<img src='assets/${imgSrc}'>`;
    aqiImgContainer.style = `background-color: ${bgColor};`;
  },

  getStatusByForAQI: function (aqi) {
    let status = '';
    if (aqi > 0) {
      switch (true) {
        case aqi < 50:
          status = 'good';
          break;
        case aqi < 100:
          status = 'moderate';
          break;
        case aqi < 150:
          status = 'unhealthyForSG';
          break;
        case aqi < 200:
          status = 'unhealthy';
          break;
        case aqi < 300:
          status = 'veryUnhealthy';
          break;
        case aqi < 500:
          status = 'hazardous';
          break;
        default:
          status = 'unknown';
      }
    } else {
      status = 'unknown';
    }
    return status;
  },

  convertPressureByAltitude: function (
    seaLevelPressure,
    altitude,
    temperatureCelsius
  ) {
    const g0 = 9.80665; // acceleration due to gravity at sea level (m/s^2)
    const M = 0.0289644; // molar mass of Earth's air (kg/mol)
    const R = 8.31432; // universal gas constant (N·m/(mol·K))
    const lapseRate = 0.0065; // temperature lapse rate (K/m)

    // Convert temperature from Celsius to Kelvin
    const altitudeTemperature = temperatureCelsius + 273.15;

    // Calculate the pressure at the given altitude
    const pressure =
      seaLevelPressure *
      Math.pow(
        1 - (lapseRate * altitude) / altitudeTemperature,
        (g0 * M) / (R * lapseRate)
      );

    return pressure;
  },

  getCurrentTime: function () {
    const now = new Date();
    const hours = now.getHours();
    const minutes = now.getMinutes();
    const seconds = now.getSeconds();

    // Format the time as HH:MM:SS
    const formattedTime = `${this.padZero(hours)}:${this.padZero(
      minutes
    )}:${this.padZero(seconds)}`;

    return formattedTime;
  },

  // Helper function to pad single digits with leading zeros
  padZero: function (num) {
    return num.toString().padStart(2, '0');
  },
};

const queryString = window.location.search;
const urlParams = new URLSearchParams(queryString);
const lang = urlParams.get('lang') || 'en';
comAmudarIO.language = lang;
comAmudarIO.start();
